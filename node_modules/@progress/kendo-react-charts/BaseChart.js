/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2024 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const C=require("react"),w=require("prop-types"),b=require("@progress/kendo-react-intl"),I=require("@progress/kendo-charts"),u=require("@progress/kendo-react-common"),m=require("./utils/index.js"),D=require("./events/chart-event-builder.js"),y=require("./events/dom-event.js"),k=require("./theming/theme-service.js"),g=require("./store/store.js"),S=require("./store/reducer.js"),E=require("./tooltip/Series.js"),P=require("./tooltip/CrosshairContainer.js"),T=require("./ChartContext.js"),O=require("./package-metadata.js"),q=require("./events/drilldown-event.js");function x(p){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(p){for(const e in p)if(e!=="default"){const s=Object.getOwnPropertyDescriptor(p,e);Object.defineProperty(t,e,s.get?s:{enumerable:!0,get:()=>p[e]})}}return t.default=p,Object.freeze(t)}const l=x(C),f=class f extends l.Component{constructor(t){super(t),this.chartInstance=null,this.surface=null,this._element=null,this.optionsStore={},this.optionsUnsubscriber=Function.prototype,this.themeStore={},this.themeUnsubscriber=Function.prototype,this.observersStore={},this.suppressTransitions=!1,this.showLicenseWatermark=!1,this.onRender=e=>{this.chartInstance!==null&&(this.surface=e.sender.surface,this.trigger("render",e))},this.onDrilldown=e=>{var a;const{series:s}=this.optionsStore.getState(),r=s.find(n=>n.name===e.series.name);if(!r.drilldownSeriesFactory)return!0;const i="onDrilldown";if(this.props.hasOwnProperty(i)){const n={seriesName:r.name,drilldownValue:e.value},c=[...((a=this.props.drilldownState)==null?void 0:a.steps)||[],n],h=this.props.getTarget(),d={...e,currentState:this.props.drilldownState,nextState:{steps:c}},o=new q.DrilldownEvent(d,h);this.props[i].call(void 0,o)}return!0},this.onLegendItemClick=e=>{if(this.chartInstance!==null)if(this.props.onLegendItemClick)this.trigger("legendItemClick",e);else{const{series:s}=this.optionsStore.getState();if(!s)return;let r={};const{seriesIndex:i,pointIndex:a}=e,n=s[i];if(a===void 0)r=Object.assign({},n,{visible:m.toggle(n.visible)});else{const c=n.pointVisibility=n.pointVisibility||[];c[a]=m.toggle(c[a]),r=Object.assign({},n)}this.optionsStore.dispatch({chartCollectionIdxKey:`series_${i}`,payload:r}),this.suppressTransitions=!0}},this.onWindowResize=()=>{this.chartInstance!==null&&this.chartInstance.resize()},this.onChartMouseLeave=e=>{const s=y.toDomEvent(this,e);this.triggerDomEvent("onMouseLeave",s)?e.preventDefault():this.chartInstance!==null&&this.chartInstance.hideElements()},this.onChildMouseLeave=e=>{const{syntheticEvent:s}=e;return this.chartInstance&&!m.hasParent(s.relatedTarget,this.element)&&this.chartInstance.hideElements(),!1},u.validatePackage(O.packageMetadata),this.showLicenseWatermark=u.shouldShowValidationUI(O.packageMetadata),this.optionsStore=g.createStore(S.optionsReducer),this.observersStore=g.createStore(S.observersReducer),this.childrenObserver=new I.InstanceObserver(this,{onMouseLeave:"onChildMouseLeave"}),this.state={optionsStore:this.optionsStore,observersStore:this.observersStore,childrenObserver:this.childrenObserver,drilldownState:{steps:[]}},this.themeStore=g.createStore(S.themeReducer),this.chartObserver=new I.InstanceObserver(this,{render:"onRender",legendItemClick:"onLegendItemClick",drilldown:"onDrilldown"})}get element(){return this._element}static getDerivedStateFromProps(t,e){return{...e,drilldownState:t.drilldownState||[]}}componentDidMount(){var e;const t=((e=this._element)==null?void 0:e.ownerDocument)||document;k.loadTheme(this.themeStore,this.instantiateCoreChart.bind(this),t),this.optionsUnsubscriber=this.optionsStore.subscribe(this.refresh.bind(this)),this.themeUnsubscriber=this.themeStore.subscribe(this.refresh.bind(this)),window.addEventListener("resize",this.onWindowResize)}componentWillUnmount(){this.optionsUnsubscriber(),this.themeUnsubscriber(),this.chartInstance!==null&&(this.chartInstance.destroy(),this.chartInstance=null),window.removeEventListener("resize",this.onWindowResize)}componentDidUpdate(t){const{dir:e,children:s,...r}=this.props;if(this.chartInstance!==null){const i=b.provideIntlService(this),a=this.chartInstance.chartService,n=i.locale!==a._intlService.locale,c=Object.entries(t).filter(h=>h[0]!=="dir"&&h[0]!=="children").some(h=>{const[d,o]=h;return!(r.hasOwnProperty(d)&&r[d]===o)});n&&(this.chartInstance.chartService._intlService=i,this.chartInstance.chartService.format._intlService=i,c||this.chartInstance.noTransitionsRedraw()),c&&this.refresh(),t.dir!==e&&this.chartInstance.setDirection(this.getDirection(e))}}render(){const{style:t={},className:e,wrapper:s,children:r}=this.props,i=Object.assign({},t,{position:"relative"}),a=l.createElement(s,{className:e,style:i,key:"chartElement"},l.createElement("div",{onMouseLeave:this.onChartMouseLeave,ref:n=>this._element=n,className:"k-chart-surface"},r),l.createElement(l.Fragment,null,this.showLicenseWatermark&&l.createElement(u.WatermarkOverlay,null)));return l.createElement(T.ChartContext.Provider,{value:this.state},l.createElement(E.SeriesTooltip,{key:"seriesTooltip"}),l.createElement(P.CrosshairTooltipContainer,{key:"crosshairTooltips"}),a)}getDirection(t){return(t!==void 0?t:u.canUseDOM&&window.getComputedStyle(this.element).direction||"ltr")==="rtl"}getChartOptions(){const{renderAs:t,pannable:e,zoomable:s,paneDefaults:r,panes:i,transitions:a,seriesColors:n,seriesDefaults:c,axisDefaults:h,deriveOptionsFromParent:d}=this.props;let o={};return t!==void 0&&(o.renderAs=t),e!==void 0&&(o.pannable=e),s!==void 0&&(o.zoomable=s),r!==void 0&&(o.paneDefaults=r),i!==void 0&&(o.panes=i),a!==void 0&&(o.transitions=a),n!==void 0&&(o.seriesColors=n),c!==void 0&&(o.seriesDefaults=c),h!==void 0&&(o.axisDefaults=h),o=Object.assign(o,this.optionsStore.getState()),d&&(o=d(o)),o}refresh(){if(this.chartInstance!==null){const t=this.themeStore.getState(),e=this.getChartOptions(),s=e.transitions;this.suppressTransitions&&(e.transitions=!1),this.props.onRefresh?this.props.onRefresh.call(void 0,e,t,this.chartInstance):this.chartInstance.setOptions(e,t),this.suppressTransitions&&(e.transitions=s,this.suppressTransitions=!1)}}instantiateCoreChart(){const{dir:t,chartConstructor:e}=this.props,s=this.getChartOptions();this.chartInstance=new e(this.element,s,this.themeStore.getState(),{rtl:this.getDirection(t),intlService:b.provideIntlService(this),observer:this.chartObserver,sender:this})}trigger(t,e){const s=this.props.getTarget(),r=D.create(t,e,s),i="on"+t.charAt(0).toUpperCase()+t.slice(1),a=this.observersStore.getState();let n=!1;for(let c=0;c<a.length;c++)a[c].trigger(t,e)&&(n=!0);return n===!1&&r&&this.props.hasOwnProperty(i)?(this.props[i].call(void 0,r),r.isDefaultPrevented&&r.isDefaultPrevented()):n}requiresHandlers(t){for(let e=0;e<t.length;e++){const s=t[e],r="on"+s.charAt(0).toUpperCase()+s.slice(1);if(this.props.hasOwnProperty(r))return!0}return!1}triggerDomEvent(t,e){const s=this.observersStore.getState();let r=!1;for(let i=0;i<s.length;i++)s[i].trigger(t,e)&&(r=!0);return r}};f.propTypes={dir:w.string,renderAs:w.oneOf(["svg","canvas"])},f.defaultProps={renderAs:"svg"};let v=f;b.registerForIntl(v);exports.BaseChart=v;
